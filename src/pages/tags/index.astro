---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

// Get all blog posts
const posts = await getCollection('blog');

// Extract unique tags
const allTags = posts
  .filter(post => post.data.tags)
  .flatMap(post => post.data.tags as string[] || []);

const uniqueTags: string[] = [...new Set(allTags)].sort();

// Count posts per tag
const tagCounts: Record<string, number> = {};
uniqueTags.forEach((tag: string) => {
  tagCounts[tag] = posts.filter(post => 
    post.data.tags?.includes(tag)
  ).length;
});

const title = 'Blog Tags';
const description = 'Browse all blog tags';
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <style>
      main {
        padding-bottom: 3rem;
      }
      
      .page-title {
        font-size: 2.5rem;
        margin-bottom: 2rem;
        color: var(--accent-dark);
        text-align: center;
      }
      
      .page-description {
        text-align: center;
        color: rgb(var(--gray));
        max-width: 600px;
        margin: 0 auto 3rem;
      }
      
      .tags-container {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
      }
      
      .tag-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
        justify-content: center;
        margin-bottom: 2rem;
      }
      
      .tag-link {
        display: inline-block;
        background-color: rgba(var(--gray-light), 0.7);
        color: rgb(var(--gray-dark));
        padding: 0.4rem 1rem;
        border-radius: 20px;
        text-decoration: none;
        font-size: 0.95rem;
        transition: all 0.2s ease;
      }
      
      .tag-link:hover {
        background-color: rgba(var(--gray-light), 1);
        transform: translateY(-2px);
      }
      
      .tag-name {
        font-weight: 500;
      }
      
      .tag-count {
        margin-left: 5px;
        opacity: 0.7;
        font-size: 0.85rem;
      }
      
      .no-tags {
        text-align: center;
        background: rgba(var(--gray-light), 0.5);
        padding: 2rem;
        border-radius: 12px;
      }
      
      .tag-sizes-1 { font-size: 0.8rem; }
      .tag-sizes-2 { font-size: 0.9rem; }
      .tag-sizes-3 { font-size: 1rem; }
      .tag-sizes-4 { font-size: 1.1rem; }
      .tag-sizes-5 { font-size: 1.2rem; }
      
      @media (max-width: 600px) {
        .tag-cloud {
          gap: 0.5rem;
        }
        
        .tag-link {
          padding: 0.3rem 0.8rem;
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <h1 class="page-title">Blog Tags</h1>
      <p class="page-description">Browse articles by tags to discover related content.</p>
      
      {uniqueTags.length > 0 ? (
        <div class="tags-container">
          <div class="tag-cloud">
            {uniqueTags.map((tag) => {
              // Basic size algorithm based on post count
              const count = tagCounts[tag];
              const minCount = Math.min(...Object.values(tagCounts));
              const maxCount = Math.max(...Object.values(tagCounts));
              
              // Calculate size class (1-5) based on count
              let sizeClass = 3; // Default mid-size
              
              if (maxCount > minCount) {
                const range = maxCount - minCount;
                const step = range / 5 || 1;
                sizeClass = Math.max(1, Math.min(5, Math.ceil((count - minCount) / step)));
              }
              
              return (
                <a href={`/tag/${tag.toLowerCase()}`} class={`tag-link tag-sizes-${sizeClass}`}>
                  <span class="tag-name">#{tag}</span>
                  <span class="tag-count">({count})</span>
                </a>
              );
            })}
          </div>
        </div>
      ) : (
        <div class="no-tags">
          <h3>No tags yet</h3>
          <p>There are no tagged blog posts yet.</p>
          <a href="/blog">View all blog posts</a>
        </div>
      )}
    </main>
    <Footer />
  </body>
</html>
