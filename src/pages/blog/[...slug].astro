---
import { getEntry, render } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';

// For SSR, we use Astro.params to get the slug from the URL
const { slug } = Astro.params;

if (!slug) {
  throw new Error("Slug is required");
}

// Get the blog post by its slug
const entry = await getEntry('blog', slug);

// If post doesn't exist, return a 404
if (!entry) {
  return Astro.redirect('/404');
}

// In Astro v5, we use render() function
const { Content, remarkPluginFrontmatter } = await render(entry);

// Get the raw content as a string for reading time calculation
const rawContent = entry.body || "";
---

<BlogPost data={entry.data} content={rawContent}>
	<Content />
</BlogPost>
